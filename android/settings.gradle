// android/settings.gradle (final)

pluginManagement {
    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
        // Flutter engine artifacts (CI friendly)
        maven { url "https://storage.googleapis.com/download.flutter.io" }
        // Extra fallback repos
        maven { url "https://maven.google.com" }
        maven { url "https://dl.google.com/dl/android/maven2/" }
    }
}

dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    repositories {
        google()
        mavenCentral()
        // Flutter engine artifacts (kept as fallback)
        maven { url "https://storage.googleapis.com/download.flutter.io" }
        // Extra fallback repos
        maven { url "https://maven.google.com" }
        maven { url "https://dl.google.com/dl/android/maven2/" }
        // jcenter kept only as harmless fallback (optional)
        // jcenter()
    }
}

rootProject.name = "visora_ai"

// -----------------------------
// Read local.properties (if present) to discover Flutter SDK path.
// This approach is CI-friendly and avoids calling file(...) in settings context.
// -----------------------------
import java.util.Properties

def localProperties = new Properties()
def localPropertiesFile = new File(rootDir, "local.properties")   // use rootDir here (settings.gradle context)

if (localPropertiesFile.exists()) {
    localPropertiesFile.withReader('UTF-8') { reader ->
        localProperties.load(reader)
    }
}

// Prefer FLUTTER_ROOT environment variable if set (Actions sets Flutter via action)
def flutterRoot = System.getenv("FLUTTER_ROOT")
if (flutterRoot == null || flutterRoot.trim().length() == 0) {
    flutterRoot = localProperties.getProperty("flutter.sdk")
}

if (flutterRoot == null || flutterRoot.trim().length() == 0) {
    // Fail early with clear message in CI logs
    throw new GradleException(
        "Flutter SDK not found. Set FLUTTER_ROOT environment variable or add 'flutter.sdk' in local.properties.\n" +
        "Example local.properties entry:\nflutter.sdk=/path/to/flutter\n" +
        "This error is intentional to fail fast in CI and show a clear message."
    )
}

// Apply Flutter gradle integration from the detected SDK
apply from: "${flutterRoot}/packages/flutter_tools/gradle/flutter.gradle"

// include project modules
include ":app"
// include ':feature_module' // add other modules if needed
