// android/settings.gradle (final)
pluginManagement {
    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()

        // Flutter engine artifacts (CI friendly)
        maven { url "https://storage.googleapis.com/download.flutter.io" }

        // Extra fallback repos
        maven { url "https://maven.google.com" }
        maven { url "https://dl.google.com/dl/android/maven2/" }
    }
}

dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    repositories {
        google()
        mavenCentral()

        // Flutter engine artifacts (kept as fallback)
        maven { url "https://storage.googleapis.com/download.flutter.io" }

        // Extra fallback repos
        maven { url "https://maven.google.com" }
        maven { url "https://dl.google.com/dl/android/maven2/" }

        // keep jcenter() as a harmless fallback if you need it (optional)
        // jcenter()
    }
}

rootProject.name = "visora_ai"

// ----------------------------
// Read local.properties (if present) to discover flutter SDK path
// This approach is CI-friendly and avoids calling file("...") incorrectly.
// ----------------------------
import java.util.Properties

def localProperties = new Properties()
def localPropertiesFile = rootProject.file('local.properties')

if (localPropertiesFile.exists()) {
    localPropertiesFile.withReader('UTF-8') { reader ->
        localProperties.load(reader)
    }
}

// Prefer FLUTTER_ROOT environment variable if set (useful in CI)
def flutterRoot = System.getenv("FLUTTER_ROOT")
if (flutterRoot == null || flutterRoot.trim().length() == 0) {
    flutterRoot = localProperties.getProperty("flutter.sdk") ?: localProperties.getProperty("flutter.root")
}

if (flutterRoot == null || flutterRoot.trim().length() == 0) {
    throw new GradleException(
        "Flutter SDK not found. Set FLUTTER_ROOT env var or add flutter.sdk to local.properties.\n" +
        "Example local.properties entry:\nflutter.sdk=/path/to/flutter\n" +
        "This error is intentional to fail fast in CI with a clear message."
    )
}

// Apply Flutter gradle integration from detected SDK
apply from: "${flutterRoot}/packages/flutter_tools/gradle/flutter.gradle"

// include project modules
include(":app")
// include ':feature_module' // add other modules if you have them
